import streamlit as st
from nba_api.stats.endpoints import playergamelog
from nba_api.stats.static import players

st.title(üèÄ NBA Deep-Dive Usage & Trends)

# INPUTS
player_name = st.text_input(Enter NBA Player Name, LeBron James)
target_line = st.number_input(Target Points Line, value=25.5)

# USAGE BOOST LOGIC
st.sidebar.header(Usage Reallocation)
star_out = st.sidebar.toggle(Is a High-Usage Teammate OUT)
teammate_usg = st.sidebar.slider(Injured Teammate's USG%, 0.0, 35.0, 25.0) if star_out else 0

def get_nba_analysis(name, line, boost_val)
    # 1. Get Player ID
    player_dict = players.find_players_by_full_name(name)
    if not player_dict return Player not found
    p_id = player_dict[0]['id']
    
    # 2. Fetch Last 5 Games
    gamelog = playergamelog.PlayerGameLog(player_id=p_id, season='2025-26').get_data_frames()[0]
    last_5 = gamelog.head(5)
    avg_pts = last_5['PTS'].mean()
    
    # 3. Apply Usage Boost
    # Formula Every 10% of missing usage reallocates ~3.5% to the star
    boost_multiplier = 1 + ((boost_val  10)  0.035)
    projected_pts = avg_pts  boost_multiplier
    
    return avg_pts, projected_pts, last_5

avg, projected, df = get_nba_analysis(player_name, target_line, teammate_usg)

# DISPLAY
st.subheader(fAnalysis for {player_name})
c1, c2 = st.columns(2)
c1.metric(Last 5 Avg, f{avg} PTS)
c2.metric(Projected (w Usage Boost), f{projected.1f} PTS)

if star_out
    st.success(füî• Usage Boost Active Teammate's {teammate_usg}% usage reallocated to {player_name}.)

st.write(### Recent Game Trends)
st.dataframe(df[['GAME_DATE', 'MATCHUP', 'PTS', 'MIN']])
